<!DOCTYPE html>
<html>
<head>
    <title></title>

    <script src="../libs/jquery-1.10.1.js"></script>
    <script src="../libs/jquery.xdomainajax.js"></script>
    <script src="../libs/d3.v3.min.js"></script>
    <script src="../libs/FileSaver.js"></script>
</head>
<body>

<script>
    var convertToInt;
    var output = new Array();

    $.ajax({
        url: "http://www.forbes.com/top-colleges/list/#page:1_sort:0_direction:asc_search:_filter:All%20states",
        type: 'GET',
        cache: false,
        success: function(data) {
            var DataSet = new Object;
            var root,allData, body, table;
            root = $("<div></div>")
            root.html(data.responseText)
            var list = root.find("#thelist")
            var rows = list.find("table tbody tr")
            $.each(rows, function(index,value) {
              var name;
              var rank;
              var cost;
              var sie;
              var tds = $(value).find("td")
              $.each(tds, function(index, td){
                if (index == 0){
                  rank = $(td).find("p").text();
                }
                if (index == 1){
                  name = $(td).find("h3 a").text();
                }
                if (index == 3){
                  tuition = convertToInt($(td).find("p").text().substring(1));
                }
                if (index == 4){
                  size = convertToInt($(td).find("p").text());
                }
              })
              DataSet[name] = {"rank": rank, "name": name,"tuition": tuition, "size": size}
              
            })
            saveToFile(DataSet,"college.json")
        },
        error: function() {
            return console.log("error");
        }
    });

    convertToInt = function(s) {
        return parseInt(s.replace(/,/g, ""), 10);
    };
	
    /* takes an array of strings
       and writes them line by line into a file given by filename
     */
    var saveToFile = function(object, filename){
        var blob, blobText;
        blobText = [JSON.stringify(object)];
        blob = new Blob(blobText, {
            type: "text/plain;charset=utf-8"
        });
        saveAs(blob, filename);
    }



</script>


</body>
</html>